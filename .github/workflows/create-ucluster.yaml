name: Uffizzi Cluster Quickstart

on:
  pull_request:
    types: [opened,reopened,synchronize,closed]

permissions:
  id-token: write

jobs:
  oof-take-it-easy:
    name: testing ucluster creation via action
    runs-on: ubuntu-latest
    steps:
      - name: cluster-create
        id: cluster-create
        uses: UffizziCloud/cluster-action@main
        with:
          server: https://pr-1074-deployment-29862-uffizzi-platform.app.uffizzi.com/
          username: admin@uffizzi.com
          password: ${{ secrets.uffizzi_password }}
          project: default
          cluster-name: pr-test-xyz
          #cluster-name: pr-${{ github.event.repository.name }}-${{ github.event.number }}

      # - name: get kubeconfig
      #   uses: actions/download-artifact@v3
      #   with:
      #     name: kubeconfig
      #     path: kubeconfig

      - name: apply kube manifests
        run: |
          echo "Here!"
          kubeconfig_content="${{ steps.cluster-create.outputs.kubeconfig }}"
          echo $kubeconfig_content
          echo $kubeconfig_content > kubeconfig
          kubectl apply -f manifests/ --kubeconfig kubeconfig
